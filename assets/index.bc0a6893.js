import{aU as s,af as q}from"./index.834e57e7.js";import{b as l}from"./axios.473f2f39.js";var o={dateFormat:"YYYY-MM-DD",requisitiondetails:{id:null,location:null,requested_by:null,approved_by:null,rs_number:"",date_requested:"",date_needed:""},requisitiondetailsitems:[],requisitionedit:{id:null,location:null,location_label:null,requested_by:null,requested_by_label:null,requisition_request_items:[]},requisitioneditcolumns:[{name:"quantity",label:"Quantity",field:"quantity",align:"left"},{name:"unit",label:"Unit",field:"unit",align:"left"},{name:"description_label",label:"Description",field:"description_label",align:"left"},{name:"purpose",label:"Purpose",field:"purpose",align:"left"}],requisitiondetailscolumns:[{name:"quantity",label:"Quantity",field:"quantity",align:"left"},{name:"unit",label:"Unit",field:"unit",align:"left"},{name:"description",label:"Description",field:e=>e.description.name,align:"left"},{name:"purpose",label:"Purpose",field:"purpose",align:"left"}],requisition_request:{id:0,location:null,requested_by:null,approved_by:null,rs_number:"",date_requested:"",date_needed:"",requisition_request_items:[]},requisition_request_item:{id:0,item_number:null,quantity:null,unit:"",description:"",description_label:"",purpose:""},requestdetailsinput:[{name:"quantity",label:"Quantity",icon:"123",type:"input"},{name:"unit",label:"Unit",icon:"ad_units",type:"input"},{name:"description",label:"Description",icon:"search",type:"select"},{name:"purpose",label:"Purpose",icon:"sunny",type:"input"}],listallitemstableloading:!1,postrequisitionrequestitemloading:!1,requisitionrequestdialog:!1,requisitiondetailspagedialog:!1,requisitiondetailsloadingpage:!1,requisitionsearchrsnumberloading:!1,requisitionapprovalloading:!1,requisitiondisapprovalloading:!1,tableindexrows:[],tableindexcolumns:[{name:"rs_number",label:"RS Number",field:"rs_number",align:"left"},{name:"location",label:"Location",field:e=>e.location.name,align:"left"},{name:"requested_by",label:"Requested By",field:e=>e.requested_by.name,align:"left"},{name:"date_requested",label:"Date Requested",field:"date_requested",align:"left"},{name:"date_needed",label:"Date Needed",field:"date_needed",align:"left"},{name:"status",label:"Status",field:"status",align:"left"}],tablecreatecolumns:[{name:"item_number",label:"Item Number",field:"item_number",align:"left"},{name:"quantity",label:"Quantity",field:"quantity",align:"left"},{name:"unit",label:"Unit",field:"unit",align:"left"},{name:"description_label",label:"Description",field:"description_label",align:"left"},{name:"purpose",label:"Purpose",field:"purpose",align:"left"}],tablecreaterows:[],createrequisitionrequest:{location:null,requested_by:null,approved_by:null,rs_number:"",date_requested:"",date_needed:"",requisition_request_items:[]},selected:[],rsnumbersearchresults:[],requisitionitemsresults:[],editable:!0,requisitioneditdialog:!1,requisitionaddeditdialog:!1,deleterequisitionitemloading:!1,itemselected:[],removerequisitionitemloading:!1,updaterequisitioneditloading:!1};const m=e=>{e.listallitemstableloading=!0,l.get("requisition/").then(t=>{t.status===200&&(e.tableindexrows=t.data.results)}).catch(t=>{s.create({timeout:1500,position:"center",color:"red",message:`Error: ${JSON.stringify(t.response)}`})}).finally(()=>{setTimeout(()=>{e.listallitemstableloading=!1},500)})},c=(e,t)=>{l.get(`requisition/${t}/`).then(i=>{i.status===200&&(e.requisitiondetails.id=i.data.id,e.requisitiondetails.location=i.data.location.name,e.requisitiondetails.requested_by=i.data.requested_by.name,e.requisitiondetails.rs_number=i.data.rs_number,e.requisitiondetails.date_requested=i.data.date_requested,e.requisitiondetails.date_needed=i.data.date_needed,e.requisitiondetailsitems=i.data.requisition_request_items,e.requisitiondetails.approved_by=i.data.approved_by!=null?i.data.approved_by.name:"")}).catch(i=>{s.create({timeout:1500,position:"center",color:"red",message:`Error: ${JSON.stringify(i.response)}`})}).finally(()=>{setTimeout(()=>{e.requisitiondetailsloadingpage=!1},500)})},p=(e,t)=>{console.log(t),e.postrequisitionrequestitemloading=!0,l.post("requisition/",t).then(i=>{i.status===200&&s.create({timeout:1500,position:"center",color:"primary",message:"Requisition Slip Saved"})}).catch(i=>{s.create({timeout:1500,position:"center",color:"red",message:`Error: ${JSON.stringify(i.response.data)}`})}).finally(()=>{e.createrequisitionrequest={location:null,requested_by:null,approved_by:null,rs_number:"",date_requested:"",date_needed:"",requisition_request_items:[]},setTimeout(()=>{e.postrequisitionrequestitemloading=!1,e.router.push({path:"/Requisition"})},1500)})},_=e=>{e.requisitionrequestdialog=!0},u=e=>{e.requisitionrequestdialog=!1},a=e=>{e.requisition_request_item={id:0,item_number:null,quantity:null,unit:"",description:"",purpose:""}},b=e=>{let t=e.requisition_request_item;t.item_number=e.createrequisitionrequest.requisition_request_items.length+1,e.createrequisitionrequest.requisition_request_items.push(t)},g=(e,t)=>{let i=e.createrequisitionrequest.requisition_request_items.findIndex(n=>n.item_number===t.item_number);e.createrequisitionrequest.requisition_request_items.splice(i,1)},f=e=>{e.createrequisitionrequest.requisition_request_items.forEach((t,i)=>{t.item_number=i+1})},y=e=>{e.requisitiondetailspagedialog=!0,e.requisitiondetailsloadingpage=!0},h=e=>{e.requisitiondetailspagedialog=!1,e.requisitioneditdialog=!1,e.requisitiondetails={},e.requisitiondetailsitems=[]},R=(e,t)=>{e.requisitionsearchrsnumberloading=!0,l.get(`requisition_search/?rs_number=${t}`).then(i=>{i.status===200&&(e.rsnumbersearchresults=i.data)}).catch(i=>{console.log(i)}).finally(()=>{setTimeout(()=>{e.requisitionsearchrsnumberloading=!1},2e3)})},d=(e,t)=>{l.put(`requisition-approval/${t.id}/`,t).then(i=>{if(i.status===200){let n=e.tableindexrows.findIndex(r=>r.id===i.data.id);e.tableindexrows[n].is_approved=i.data.is_approved,e.tableindexrows[n].status=i.data.status,e.tableindexrows[n].approved_by=i.data.approved_by,console.log(i)}}).catch(i=>{console.log(i)}).finally(()=>{setTimeout(()=>{e.requisitiondisapprovalloading=!1,e.requisitionapprovalloading=!1,e.selected=[]},1500)})},v=e=>{e.createrequisitionrequest={location:null,requested_by:null,approved_by:null,rs_number:"",date_requested:"",date_needed:"",requisition_request_items:[]}},I=e=>{e.requisitioneditdialog=!0,e.requisitionedit.id=e.selected[0].id,e.requisitionedit.location=e.selected[0].location.id,e.requisitionedit.location_label=e.selected[0].location.name,e.requisitionedit.requested_by=e.selected[0].requested_by.id,e.requisitionedit.requested_by_label=e.selected[0].requested_by.name,e.requisitionedit.rs_number=e.selected[0].rs_number,e.requisitionedit.date_requested=e.selected[0].date_requested,e.requisitionedit.date_needed=e.selected[0].date_needed,e.requisitionedit.requisition_request_items=e.selected[0].requisition_request_items.map(t=>({id:t.id,description:t.description.id,description_label:t.description.name,item_number:t.item_number,quantity:t.quantity,unit:t.unit,purpose:t.purpose}))},D=(e,t)=>{e.deleterequisitionitemloading=!0,l.delete(`requisition/${t}/`).then(i=>{if(i.status===200){let n=e.tableindexrows.findIndex(r=>r.id===t);e.tableindexrows.splice(n,1),s.create({timeout:1500,position:"center",color:"primary",message:"Requisition Deleted"})}}).catch(i=>{s.create({timeout:1500,position:"center",color:"red",message:`Error: ${JSON.stringify(i.response)}`})}).finally(()=>{setTimeout(()=>{e.deleterequisitionitemloading=!1},500)})},x=(e,t)=>{e.removerequisitionitemloading=!0,l.delete(`requisition-items/${t}/`).then(i=>{if(i.status===204){let n=e.requisitionedit.requisition_request_items.findIndex(r=>r.id===t);e.requisitionedit.requisition_request_items.splice(n,1),s.create({timeout:1500,position:"center",color:"primary",message:"Item Deleted"})}}).catch(i=>{s.create({timeout:1500,position:"center",color:"red",message:`Error: ${JSON.stringify(i.response)}`})}).finally(()=>{setTimeout(()=>{e.removerequisitionitemloading=!1},500)})},S=e=>{e.requisitionaddeditdialog=!0},E=e=>{e.requisitionaddeditdialog=!1},N=e=>{let t=e.requisitionedit.id;e.updaterequisitioneditloading=!0,l.put(`requisition/${t}/`,e.requisitionedit).then(i=>{i.status===200&&s.create({timeout:1500,position:"center",color:"primary",message:"Item Updated"})}).catch(i=>{s.create({timeout:1500,position:"center",color:"red",message:`Error: ${JSON.stringify(i.response)}`})}).finally(()=>{e.requisitiondetailspagedialog=!1,e.updaterequisitioneditloading=!1,e.requisitioneditdialog=!1,e.requisitionedit={id:null,location:null,location_label:null,requested_by:null,requested_by_label:null,requisition_request_items:[]}})},A=q("requisitionslip",{state:()=>o,getters:{hasSelection:e=>e.selected.length>0,hasEditItemSelection:e=>e.itemselected.length>0,rsNumberOptions:e=>e.rsnumbersearchresults.map(t=>({label:t.rs_number,value:t.id})),isApproved:e=>e.selected.length>0?e.selected[0].is_approved===!0:!1},actions:{getAllItems(){m(this)},retrieveRequisitionItem(e){c(this,e)},postItem(e){p(this,e)},openAddRequisitionDialog(){_(this)},closeAddRequisitionDialog(){u(this),a(this)},addRequestItem(){b(this),u(this),a(this)},removeRequesItem(e){g(this,e),f(this)},openRequisitionDetailsDialog(){y(this)},closeRequisitionDetailsDialog(){h(this)},searchRsNumber(e){R(this,e)},approveRequest(e){o.requisitionapprovalloading=!0,d(this,e)},disapproveRequest(e){o.requisitiondisapprovalloading=!0,d(this,e)},resetCreateItem(){a(this),v(this)},openEditDialog(){I(this)},removeRequesitionRequestItem(e){D(this,e)},removeRequisitionItem(e){x(this,e)},openAddEditDialog(){S(this)},closeAddEditDialog(){E(this)},updateRequisitionRequest(){N(this)}}});export{A as u};
